<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Educational Games Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Nunito', sans-serif;
        }
        .game-container {
            min-height: 400px;
        }
        .correct-bg {
            background-color: #4ade80;
            transition: background-color 0.5s;
        }
        .incorrect-bg {
            background-color: #f87171;
            transition: background-color 0.5s;
        }
    </style>
</head>
<body class="bg-blue-50">
    <div x-data="gameApp()" class="container mx-auto px-4 py-8 max-w-4xl">
        <!-- User Registration / Login -->
        <div x-show="!currentUser" class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h1 class="text-3xl font-bold text-center text-blue-600 mb-6">Educational Games Platform</h1>
            
            <div class="mb-6">
                <h2 class="text-xl font-semibold mb-4">New Player</h2>
                <div class="flex flex-col sm:flex-row gap-4">
                    <input 
                        type="text" 
                        x-model="newUserName" 
                        placeholder="Enter your name" 
                        class="px-4 py-2 border rounded-lg flex-grow"
                    >
                    <select 
                        x-model="newUserGrade" 
                        class="px-4 py-2 border rounded-lg"
                    >
                        <option value="">Select Grade</option>
                        <option value="K">Kindergarten</option>
                        <option value="1">Grade 1</option>
                        <option value="2">Grade 2</option>
                        <option value="3">Grade 3</option>
                        <option value="4">Grade 4</option>
                        <option value="5">Grade 5</option>
                    </select>
                    <button 
                        @click="registerUser()" 
                        class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg"
                    >
                        Start Playing
                    </button>
                </div>
            </div>
            
            <div x-show="savedUsers.length > 0">
                <h2 class="text-xl font-semibold mb-4">Returning Player</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                    <template x-for="user in savedUsers" :key="user.id">
                        <button 
                            @click="loginUser(user)" 
                            class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg text-center"
                        >
                            <span x-text="user.name"></span> (Grade <span x-text="user.grade"></span>)
                        </button>
                    </template>
                </div>
            </div>
        </div>

        <!-- Game Dashboard -->
        <div x-show="currentUser && !currentGame" class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-2xl font-bold text-blue-600">
                    Welcome, <span x-text="currentUser.name"></span>!
                </h1>
                <div class="flex items-center">
                    <span class="mr-4 font-semibold">
                        Points: <span x-text="currentUser.points" class="text-green-600 text-xl"></span>
                    </span>
                    <button 
                        @click="logout()" 
                        class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg"
                    >
                        Switch Player
                    </button>
                </div>
            </div>

            <div class="mb-8">
                <h2 class="text-xl font-semibold mb-4">Choose a Game</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                    <template x-for="game in filteredGames" :key="game.id">
                        <button 
                            @click="startGame(game)" 
                            class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-6 px-4 rounded-lg text-center"
                        >
                            <span x-text="game.name" class="block text-lg"></span>
                            <span x-text="game.category" class="block text-sm opacity-80"></span>
                        </button>
                    </template>
                </div>
            </div>

            <div class="mb-8">
                <h2 class="text-xl font-semibold mb-4">Rewards Shop</h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                    <template x-for="reward in rewards" :key="reward.id">
                        <div class="bg-yellow-100 rounded-lg p-4 border border-yellow-300">
                            <h3 x-text="reward.name" class="font-bold text-lg mb-1"></h3>
                            <p class="text-green-700 font-bold mb-2"><span x-text="reward.cost"></span> points</p>
                            <button 
                                @click="purchaseReward(reward)" 
                                :disabled="currentUser.points < reward.cost"
                                :class="currentUser.points >= reward.cost ? 
                                    'bg-yellow-500 hover:bg-yellow-600' : 
                                    'bg-gray-300 cursor-not-allowed'"
                                class="text-white font-bold py-2 px-4 rounded-lg w-full"
                            >
                                Purchase
                            </button>
                        </div>
                    </template>
                </div>
            </div>

            <div x-show="rewardHistory.length > 0" class="mb-8">
                <h2 class="text-xl font-semibold mb-4">Reward History</h2>
                <div class="bg-gray-100 rounded-lg p-4">
                    <ul class="list-disc pl-5">
                        <template x-for="(item, index) in rewardHistory" :key="index">
                            <li class="mb-1">
                                <span x-text="item.reward.name"></span> - 
                                <span x-text="new Date(item.date).toLocaleDateString()"></span>
                            </li>
                        </template>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Game Play Area -->
        <div 
            x-show="currentUser && currentGame" 
            :class="feedbackClass"
            class="bg-white rounded-lg shadow-lg p-6 mb-8 game-container"
        >
            <div class="flex justify-between items-center mb-6">
                <h1 class="text-2xl font-bold text-blue-600" x-text="currentGame.name"></h1>
                <div class="flex items-center">
                    <span class="mr-4 font-semibold">
                        Time: <span x-text="formatTime(timeRemaining)" class="text-orange-600 text-xl"></span>
                    </span>
                    <span class="mr-4 font-semibold">
                        Score: <span x-text="currentScore" class="text-green-600 text-xl"></span>
                    </span>
                    <button 
                        @click="exitGame()" 
                        class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg"
                    >
                        Exit Game
                    </button>
                </div>
            </div>

            <!-- Math Games -->
            <div x-show="currentGame.type === 'mathBingo'" class="text-center">
                <div class="mb-6">
                    <h2 class="text-xl mb-2">Find the answer to:</h2>
                    <p class="text-3xl font-bold" x-text="currentProblem.question"></p>
                </div>
                <div class="grid grid-cols-3 sm:grid-cols-5 gap-4 max-w-md mx-auto">
                    <template x-for="(number, index) in bingoNumbers" :key="index">
                        <button 
                            @click="checkBingoAnswer(number)"
                            :class="selectedBingoNumbers.includes(number) ? 'bg-gray-300' : 'bg-blue-500 hover:bg-blue-600'"
                            class="text-white font-bold py-4 rounded-lg text-xl"
                            :disabled="selectedBingoNumbers.includes(number)"
                        >
                            <span x-text="number"></span>
                        </button>
                    </template>
                </div>
            </div>

            <div x-show="currentGame.type === 'mathProblem'" class="text-center">
                <div class="mb-6">
                    <h2 class="text-xl mb-2">Solve this problem:</h2>
                    <p class="text-3xl font-bold" x-text="currentProblem.question"></p>
                </div>
                <div class="flex flex-col sm:flex-row justify-center gap-4 max-w-md mx-auto">
                    <input 
                        type="number" 
                        x-model="userAnswer" 
                        placeholder="Your answer" 
                        class="px-4 py-2 border rounded-lg text-center text-xl"
                        @keyup.enter="checkMathAnswer()"
                    >
                    <button 
                        @click="checkMathAnswer()"
                        class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg"
                    >
                        Submit
                    </button>
                </div>
            </div>

            <!-- Language Games -->
            <div x-show="currentGame.type === 'wordScramble'" class="text-center">
                <div class="mb-6">
                    <h2 class="text-xl mb-2">Unscramble this word:</h2>
                    <p class="text-3xl font-bold" x-text="currentProblem.scrambled"></p>
                    <p class="text-md mt-2" x-text="'Hint: ' + currentProblem.hint"></p>
                </div>
                <div class="flex flex-col sm:flex-row justify-center gap-4 max-w-md mx-auto">
                    <input 
                        type="text" 
                        x-model="userAnswer" 
                        placeholder="Your answer" 
                        class="px-4 py-2 border rounded-lg text-center text-xl"
                        @keyup.enter="checkWordAnswer()"
                    >
                    <button 
                        @click="checkWordAnswer()"
                        class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg"
                    >
                        Submit
                    </button>
                </div>
            </div>

            <div x-show="currentGame.type === 'hangman'" class="text-center">
                <div class="mb-6">
                    <h2 class="text-xl mb-2">Guess the word:</h2>
                    <p class="text-3xl font-bold tracking-widest" x-text="displayedWord"></p>
                    <p class="text-md mt-2" x-text="'Hint: ' + currentProblem.hint"></p>
                    <p class="text-md mt-2">
                        Guesses left: <span x-text="guessesLeft" class="font-bold"></span>
                    </p>
                </div>
                <div class="max-w-md mx-auto">
                    <div class="grid grid-cols-7 sm:grid-cols-9 gap-2 mb-4">
                        <template x-for="letter in 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('')" :key="letter">
                            <button 
                                @click="guessLetter(letter)"
                                :disabled="guessedLetters.includes(letter)"
                                :class="guessedLetters.includes(letter) ? 'bg-gray-300' : 'bg-blue-500 hover:bg-blue-600'"
                                class="text-white font-bold py-2 rounded-lg"
                            >
                                <span x-text="letter"></span>
                            </button>
                        </template>
                    </div>
                </div>
            </div>

            <!-- IQ Games -->
            <div x-show="currentGame.type === 'iqTest'" class="text-center">
                <div class="mb-6">
                    <h2 class="text-xl mb-2" x-text="currentProblem.question"></h2>
                    <div x-show="currentProblem.imageUrl" class="my-4">
                        <img :src="currentProblem.imageUrl" class="max-w-xs mx-auto" alt="IQ Test Image">
                    </div>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 max-w-md mx-auto">
                    <template x-for="(option, index) in currentProblem.options" :key="index">
                        <button 
                            @click="checkIQAnswer(option)"
                            class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-4 rounded-lg"
                        >
                            <span x-text="option"></span>
                        </button>
                    </template>
                </div>
            </div>
        </div>

        <!-- Game Over Screen -->
        <div 
            x-show="gameOver" 
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
        >
            <div class="bg-white rounded-lg shadow-xl p-8 max-w-md w-full mx-4">
                <h2 class="text-2xl font-bold text-center mb-4">Game Over!</h2>
                <p class="text-center text-xl mb-6">
                    You scored <span class="text-green-600 font-bold" x-text="currentScore"></span> points!
                </p>
                <div class="flex justify-center">
                    <button 
                        @click="closeGameOver()" 
                        class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg"
                    >
                        Back to Games
                    </button>
                </div>
            </div>
        </div>

        <!-- Reward Purchase Confirmation -->
        <div 
            x-show="showRewardConfirmation" 
            class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
        >
            <div class="bg-white rounded-lg shadow-xl p-8 max-w-md w-full mx-4">
                <h2 class="text-2xl font-bold text-center mb-4">Reward Purchased!</h2>
                <p class="text-center text-xl mb-2" x-text="'You purchased: ' + (selectedReward ? selectedReward.name : '')"></p>
                <p class="text-center mb-6">Show this screen to claim your reward!</p>
                <div class="flex justify-center">
                    <button 
                        @click="closeRewardConfirmation()" 
                        class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-lg"
                    >
                        Awesome!
                    </button>
                </div>
            </div>
        </div>
    </div>

    <audio id="correctSound" src="https://assets.mixkit.co/active_storage/sfx/2010/2010-preview.mp3" preload="auto"></audio>
    <audio id="wrongSound" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3" preload="auto"></audio>

    <script>
        function gameApp() {
            return {
                // User management
                currentUser: null,
                newUserName: '',
                newUserGrade: '',
                savedUsers: [],
                
                // Game management
                currentGame: null,
                gameOver: false,
                timeRemaining: 0,
                timerInterval: null,
                currentScore: 0,
                feedbackClass: '',
                
                // Game specific variables
                currentProblem: {},
                userAnswer: '',
                bingoNumbers: [],
                selectedBingoNumbers: [],
                guessedLetters: [],
                guessesLeft: 6,
                displayedWord: '',
                
                // Rewards
                rewards: [
                    { id: 1, name: '15 minutes Screen Time', cost: 50 },
                    { id: 2, name: 'Ice Cream Treat', cost: 100 },
                    { id: 3, name: 'Small Lego Set', cost: 200 },
                    { id: 4, name: 'Board Game', cost: 300 },
                    { id: 5, name: 'Art Supplies', cost: 150 },
                    { id: 6, name: 'Movie Night', cost: 250 }
                ],
                showRewardConfirmation: false,
                selectedReward: null,
                rewardHistory: [],
                
                // Available games
                games: [
                    { id: 1, name: 'Math Bingo', category: 'Math', type: 'mathBingo', minGrade: 'K', maxGrade: '5' },
                    { id: 2, name: 'Math Challenge', category: 'Math', type: 'mathProblem', minGrade: '1', maxGrade: '5' },
                    { id: 3, name: 'Word Scramble', category: 'Language', type: 'wordScramble', minGrade: '1', maxGrade: '5' },
                    { id: 4, name: 'Hangman', category: 'Language', type: 'hangman', minGrade: 'K', maxGrade: '5' },
                    { id: 5, name: 'IQ Challenge', category: 'IQ Test', type: 'iqTest', minGrade: '2', maxGrade: '5' }
                ],
                
                init() {
                    this.loadUsers();
                    this.loadRewardHistory();
                },
                
                get filteredGames() {
                    if (!this.currentUser) return [];
                    
                    const grade = this.currentUser.grade;
                    return this.games.filter(game => {
                        // Convert grades to numerical values for comparison
                        const minGradeValue = game.minGrade === 'K' ? 0 : parseInt(game.minGrade);
                        const maxGradeValue = parseInt(game.maxGrade);
                        const userGradeValue = grade === 'K' ? 0 : parseInt(grade);
                        
                        return userGradeValue >= minGradeValue && userGradeValue <= maxGradeValue;
                    });
                },
                
                // User Management Functions
                loadUsers() {
                    const storedUsers = localStorage.getItem('educationalGameUsers');
                    if (storedUsers) {
                        this.savedUsers = JSON.parse(storedUsers);
                    }
                },
                
                saveUsers() {
                    localStorage.setItem('educationalGameUsers', JSON.stringify(this.savedUsers));
                },
                
                registerUser() {
                    if (!this.newUserName.trim() || !this.newUserGrade) {
                        alert('Please enter your name and select a grade.');
                        return;
                    }
                    
                    const newUser = {
                        id: Date.now(),
                        name: this.newUserName.trim(),
                        grade: this.newUserGrade,
                        points: 0
                    };
                    
                    this.savedUsers.push(newUser);
                    this.saveUsers();
                    this.loginUser(newUser);
                },
                
                loginUser(user) {
                    this.currentUser = user;
                    this.loadRewardHistory();
                },
                
                logout() {
                    this.currentUser = null;
                },
                
                updateUserPoints() {
                    const index = this.savedUsers.findIndex(user => user.id === this.currentUser.id);
                    if (index !== -1) {
                        this.savedUsers[index] = this.currentUser;
                        this.saveUsers();
                    }
                },
                
                // Game Management Functions
                startGame(game) {
                    this.currentGame = game;
                    this.currentScore = 0;
                    this.timeRemaining = 120; // 2 minutes
                    this.feedbackClass = '';
                    this.gameOver = false;
                    
                    // Set up game-specific variables
                    switch (game.type) {
                        case 'mathBingo':
                            this.setupMathBingo();
                            break;
                        case 'mathProblem':
                            this.setupMathProblem();
                            break;
                        case 'wordScramble':
                            this.setupWordScramble();
                            break;
                        case 'hangman':
                            this.setupHangman();
                            break;
                        case 'iqTest':
                            this.setupIQTest();
                            break;
                    }
                    
                    // Start the timer
                    this.timerInterval = setInterval(() => {
                        this.timeRemaining--;
                        if (this.timeRemaining <= 0) {
                            this.endGame();
                        }
                    }, 1000);
                },
                
                exitGame() {
                    if (confirm('Are you sure you want to exit? Your progress will be saved.')) {
                        this.endGame();
                    }
                },
                
                endGame() {
                    clearInterval(this.timerInterval);
                    
                    // Add points to user account
                    this.currentUser.points += this.currentScore;
                    this.updateUserPoints();
                    
                    // Show game over screen
                    this.gameOver = true;
                },
                
                closeGameOver() {
                    this.gameOver = false;
                    this.currentGame = null;
                },
                
                formatTime(seconds) {
                    const mins = Math.floor(seconds / 60);
                    const secs = seconds % 60;
                    return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
                },
                
                showFeedback(isCorrect) {
                    // Play sound
                    const sound = document.getElementById(isCorrect ? 'correctSound' : 'wrongSound');
                    sound.currentTime = 0;
                    sound.play();
                    
                    // Show visual feedback
                    this.feedbackClass = isCorrect ? 'correct-bg' : 'incorrect-bg';
                    
                    // Clear feedback after a short delay
                    setTimeout(() => {
                        this.feedbackClass = '';
                    }, 500);
                },
                
                // Math Bingo Game
                setupMathBingo() {
                    this.selectedBingoNumbers = [];
                    this.generateMathBingoProblem();
                },
                
                generateMathBingoProblem() {
                    const grade = this.currentUser.grade;
                    let max, operation;
                    
                    // Adjust difficulty based on grade
                    if (grade === 'K') {
                        max = 10;
                        operation = '+';
                    } else if (grade === '1') {
                        max = 20;
                        operation = Math.random() < 0.7 ? '+' : '-';
                    } else if (grade === '2') {
                        max = 50;
                        operation = Math.random() < 0.6 ? '+' : '-';
                    } else if (grade === '3') {
                        max = 100;
                        const rand = Math.random();
                        operation = rand < 0.4 ? '+' : (rand < 0.8 ? '-' : '×');
                    } else {
                        max = 100;
                        const rand = Math.random();
                        operation = rand < 0.3 ? '+' : (rand < 0.6 ? '-' : (rand < 0.9 ? '×' : '÷'));
                    }
                    
                    let num1, num2, answer;
                    
                    switch (operation) {
                        case '+':
                            num1 = Math.floor(Math.random() * max) + 1;
                            num2 = Math.floor(Math.random() * max) + 1;
                            answer = num1 + num2;
                            break;
                        case '-':
                            num1 = Math.floor(Math.random() * max) + 1;
                            num2 = Math.floor(Math.random() * num1) + 1; // Ensure positive result
                            answer = num1 - num2;
                            break;
                        case '×':
                            num1 = Math.floor(Math.random() * 12) + 1;
                            num2 = Math.floor(Math.random() * 12) + 1;
                            answer = num1 * num2;
                            break;
                        case '÷':
                            num2 = Math.floor(Math.random() * 12) + 1;
                            answer = Math.floor(Math.random() * 12) + 1;
                            num1 = num2 * answer; // Ensure clean division
                            break;
                    }
                    
                    this.currentProblem = {
                        question: `${num1} ${operation} ${num2} = ?`,
                        answer: answer
                    };
                    
                    // Generate bingo numbers
                    this.bingoNumbers = this.generateBingoNumbers(answer);
                },
                
                generateBingoNumbers(correctAnswer) {
                    const numbers = [correctAnswer];
                    
                    // Generate 14 more unique random numbers
                    while (numbers.length < 15) {
                        const offset = Math.floor(Math.random() * 20) - 10;
                        const newNumber = correctAnswer + offset;
                        
                        if (newNumber > 0 && !numbers.includes(newNumber)) {
                            numbers.push(newNumber);
                        }
                    }
                    
                    // Shuffle the array
                    return numbers.sort(() => Math.random() - 0.5);
                },
                
                checkBingoAnswer(number) {
                    this.selectedBingoNumbers.push(number);
                    
                    if (number === this.currentProblem.answer) {
                        this.showFeedback(true);
                        this.currentScore += 10;
                        setTimeout(() => this.generateMathBingoProblem(), 1000);
                    } else {
                        this.showFeedback(false);
                    }
                },
                
                // Math Problem Game
                setupMathProblem() {
                    this.userAnswer = '';
                    this.generateMathProblem();
                },
                
                generateMathProblem() {
                    // Reuse the same logic as math bingo
                    this.generateMathBingoProblem();
                    this.userAnswer = '';
                },
                
                checkMathAnswer() {
                    const userAnswerNum = parseInt(this.userAnswer);
                    
                    if (userAnswerNum === this.currentProblem.answer) {
                        this.showFeedback(true);
                        this.currentScore += 10;
                        this.generateMathProblem();
                    } else {
                        this.showFeedback(false);
                    }
                },
                
                // Word Scramble Game
                setupWordScramble() {
                    this.userAnswer = '';
                    this.generateWordScramble();
                },
                
                generateWordScramble() {
                    const grade = this.currentUser.grade;
                    let words;
                    
                    // Word lists by grade level
                    if (grade === 'K' || grade === '1') {
                        words = [
                            {word: 'cat', hint: 'A furry pet that meows'},
                            {word: 'dog', hint: 'A pet that barks'},
                            {word: 'sun', hint: 'It shines during the day'},
                            {word: 'hat', hint: 'You wear it on your head'},
                            {word: 'run', hint: 'Moving fast with your feet'}
                        ];
                    } else if (grade === '2' || grade === '3') {
                        words = [
                            {word: 'school', hint: 'Where you learn'},
                            {word: 'friend', hint: 'Someone you like to play with'},
                            {word: 'apple', hint: 'A fruit that can be red or green'},
                            {word: 'water', hint: 'You drink it'},
                            {word: 'happy', hint: 'Feeling good'}
                        ];
                    } else {
                        words = [
                            {word: 'science', hint: 'Study of the natural world'},
                            {word: 'computer', hint: 'Electronic device for work and games'},
                            {word: 'mountain', hint: 'Very tall landform'},
                            {word: 'adventure', hint: 'An exciting experience'},
                            {word: 'knowledge', hint: 'Information and skills gained through experience'}
                        ];
                    }
                    
                    // Select random word
                    const wordObj = words[Math.floor(Math.random() * words.length)];
                    
                    // Scramble the word
                    const scrambled = wordObj.word.split('')
                        .sort(() => Math.random() - 0.5)
                        .join('');
                    
                        scrambled: scrambled,
                        word: wordObj.word,
                        hint: wordObj.hint
                    };
                    
                    this.userAnswer = '';
                },
                
                checkWordAnswer() {
                    if (this.userAnswer.toLowerCase() === this.currentProblem.word.toLowerCase()) {
                        this.showFeedback(true);
                        this.currentScore += 10;
                        this.generateWordScramble();
                    } else {
                        this.showFeedback(false);
                    }
                },
                
                // Hangman Game
                setupHangman() {
                    this.guessedLetters = [];
                    this.guessesLeft = 6;
                    this.generateHangmanWord();
                },
                
                generateHangmanWord() {
                    const grade = this.currentUser.grade;
                    let words;
                    
                    // Word lists by grade level
                    if (grade === 'K' || grade === '1') {
                        words = [
                            {word: 'CAT', hint: 'A furry pet that meows'},
                            {word: 'DOG', hint: 'A pet that barks'},
                            {word: 'SUN', hint: 'It shines during the day'},
                            {word: 'HAT', hint: 'You wear it on your head'},
                            {word: 'BUS', hint: 'A big vehicle that carries many people'}
                        ];
                    } else if (grade === '2' || grade === '3') {
                        words = [
                            {word: 'SCHOOL', hint: 'Where you learn'},
                            {word: 'FRIEND', hint: 'Someone you like to play with'},
                            {word: 'PLANET', hint: 'Earth is one of these'},
                            {word: 'ANIMAL', hint: 'Living creatures like dogs and cats'},
                            {word: 'GARDEN', hint: 'Where plants and flowers grow'}
                        ];
                    } else {
                        words = [
                            {word: 'SCIENCE', hint: 'Study of the natural world'},
                            {word: 'COMPUTER', hint: 'Electronic device for work and games'},
                            {word: 'MOUNTAIN', hint: 'Very tall landform'},
                            {word: 'ADVENTURE', hint: 'An exciting experience'},
                            {word: 'KNOWLEDGE', hint: 'Information and skills gained through experience'}
                        ];
                    }
                    
                    // Select random word
                    const wordObj = words[Math.floor(Math.random() * words.length)];
                    
                    this.currentProblem = {
                        word: wordObj.word,
                        hint: wordObj.hint
                    };
                    
                    this.updateDisplayedWord();
                },
                
                updateDisplayedWord() {
                    this.displayedWord = this.currentProblem.word
                        .split('')
                        .map(letter => this.guessedLetters.includes(letter) ? letter : '_')
                        .join(' ');
                },
                
                guessLetter(letter) {
                    this.guessedLetters.push(letter);
                    
                    if (this.currentProblem.word.includes(letter)) {
                        this.showFeedback(true);
                        this.updateDisplayedWord();
                        
                        // Check if word is complete
                        if (!this.displayedWord.includes('_')) {
                            this.currentScore += 20;
                            setTimeout(() => this.generateHangmanWord(), 1000);
                        }
                    } else {
                        this.showFeedback(false);
                        this.guessesLeft--;
                        
                        if (this.guessesLeft <= 0) {
                            setTimeout(() => this.generateHangmanWord(), 1000);
                        }
                    }
                },
                
                // IQ Test Game
                setupIQTest() {
                    this.generateIQQuestion();
                },
                
                generateIQQuestion() {
                    const grade = this.currentUser.grade;
                    let questions;
                    
                    // Questions by grade level
                    if (grade === '2' || grade === '3') {
                        questions = [
                            {
                                question: "What comes next in the pattern: 2, 4, 6, 8, ?",
                                options: ["9", "10", "12", "14"],
                                answer: "10"
                            },
                            {
                                question: "If a cat has 4 legs, how many legs do 3 cats have?",
                                options: ["7", "12", "9", "6"],
                                answer: "12"
                            },
                            {
                                question: "Which shape doesn't belong?",
                                options: ["Circle", "Square", "Triangle", "Rainbow"],
                                answer: "Rainbow"
                            },
                            {
                                question: "If today is Tuesday, what day was it yesterday?",
                                options: ["Wednesday", "Monday", "Sunday", "Thursday"],
                                answer: "Monday"
                            }
                        ];
                    } else {
                        questions = [
                            {
                                question: "What number comes next: 1, 4, 9, 16, 25, ?",
                                options: ["30", "36", "49", "64"],
                                answer: "36"
                            },
                            {
                                question: "If a clock shows 3:45, what is the angle between the hour and minute hands?",
                                options: ["90°", "97.5°", "107.5°", "112.5°"],
                                answer: "97.5°"
                            },
                            {
                                question: "Which word doesn't belong?",
                                options: ["Apple", "Banana", "Carrot", "Orange"],
                                answer: "Carrot"
                            },
                            {
                                question: "If 5 workers can build a wall in 8 days, how many days would it take 10 workers to build the same wall?",
                                options: ["16", "4", "2", "40"],
                                answer: "4"
                            }
                        ];
                    }
                    
                    // Select random question
                    const question = questions[Math.floor(Math.random() * questions.length)];
                    this.currentProblem = question;
                },
                
                checkIQAnswer(answer) {
                    if (answer === this.currentProblem.answer) {
                        this.showFeedback(true);
                        this.currentScore += 15;
                        this.generateIQQuestion();
                    } else {
                        this.showFeedback(false);
                    }
                },
                
                // Rewards System
                loadRewardHistory() {
                    if (!this.currentUser) return;
                    
                    const historyKey = `rewardHistory_${this.currentUser.id}`;
                    const storedHistory = localStorage.getItem(historyKey);
                    
                    if (storedHistory) {
                        this.rewardHistory = JSON.parse(storedHistory);
                    } else {
                        this.rewardHistory = [];
                    }
                },
                
                saveRewardHistory() {
                    if (!this.currentUser) return;
                    
                    const historyKey = `rewardHistory_${this.currentUser.id}`;
                    localStorage.setItem(historyKey, JSON.stringify(this.rewardHistory));
                },
                
                purchaseReward(reward) {
                    if (this.currentUser.points < reward.cost) {
                        alert("You don't have enough points for this reward!");
                        return;
                    }
                    
                    // Deduct points
                    this.currentUser.points -= reward.cost;
                    this.updateUserPoints();
                    
                    // Add to history
                    this.rewardHistory.unshift({
                        reward: reward,
                        date: new Date().toISOString()
                    });
                    this.saveRewardHistory();
                    
                    // Show confirmation
                    this.selectedReward = reward;
                    this.showRewardConfirmation = true;
                },
                
                closeRewardConfirmation() {
                    this.showRewardConfirmation = false;
                    this.selectedReward = null;
                }
            };
        }
    </script>
</body>
</html>
